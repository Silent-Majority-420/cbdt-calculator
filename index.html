<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>CBDT Framework Calculator - Cannabis Policy Analysis Tool with Federal Reform Impact</title>
    <meta name="title" content="CBDT Framework Calculator - Cannabis Policy Analysis Tool with Federal Reform Impact">
    <meta name="description" content="Interactive Consumer-Driven Black Market Displacement (CBDT) Framework calculator with 280E and SAFE Banking impact analysis. Validated predictive model with 5% mean absolute error across 24 U.S. markets.">
    <meta name="keywords" content="cannabis policy, CBDT framework, legal cannabis market, black market displacement, cannabis regulation, market analysis, 280E, SAFE Banking, federal cannabis reform">
    <meta name="author" content="The Silent Majority 420">
    <meta name="robots" content="index, follow">
    <link rel="canonical" content="https://www.cbdttheory.com/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="CBDT Framework Calculator - Cannabis Policy Analysis Tool">
    <meta property="og:description" content="Interactive tool for predicting legal cannabis market share with federal reform impact analysis (280E, SAFE Banking)">
    <meta property="og:image" content="https://www.cbdttheory.com/og-image.jpg">
    <meta property="og:url" content="https://www.cbdttheory.com/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CBDT Framework Calculator">
    <meta name="twitter:description" content="Interactive cannabis policy analysis tool with federal reform impact">
    <meta name="twitter:image" content="https://www.cbdttheory.com/twitter-image.jpg">
    <meta name="twitter:site" content="@The_Silent_420">
    <meta name="twitter:creator" content="@The_Silent_420">
    
    <link rel="icon" type="image/png" href="logo.png">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "CBDT Framework Calculator",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "description": "Interactive calculator for the Consumer-Driven Black Market Displacement Framework with federal reform impact analysis",
      "author": {
        "@type": "Person",
        "name": "The Silent Majority 420",
        "identifier": "https://orcid.org/0009-0003-6779-9910"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .validation-badge {
            display: inline-block;
            background: #48bb78;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }
        
        .section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .section h2 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .preset-button {
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .preset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .preset-button:active {
            transform: translateY(0);
        }
        
        .lever-group {
            margin-bottom: 30px;
        }
        
        .lever-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .lever-value {
            color: #667eea;
            font-size: 1.1em;
        }
        
        .lever-description {
            font-size: 0.85em;
            color: #718096;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
        }
        
        .results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .result-main {
            font-size: 4em;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .result-label {
            font-size: 1.2em;
            opacity: 0.95;
            margin-bottom: 15px;
        }
        
        .result-interpretation {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .utility-score {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .reform-impact-box {
            background: #48bb78;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .reform-impact-box.active {
            display: block;
        }
        
        .reform-impact-title {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 12px;
        }
        
        .reform-impact-details {
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .reform-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .reform-stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 6px;
        }
        
        .reform-stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .reform-stat-value {
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s ease;
        }
        
        .checkbox-label:hover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .checkbox-label input[type="checkbox"]:checked {
            background: #667eea;
        }
        
        .checkbox-text {
            flex: 1;
        }
        
        .checkbox-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .checkbox-desc {
            font-size: 0.85em;
            color: #718096;
            line-height: 1.4;
        }
        
        .info-section {
            background: #edf2f7;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .info-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .info-section p {
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .info-section ul {
            margin-left: 20px;
            color: #4a5568;
            line-height: 1.7;
        }
        
        .social-share-container {
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
        }
        
        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            color: white;
        }
        
        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .share-twitter {
            background-color: #1DA1F2;
        }
        
        .share-twitter:hover {
            background-color: #1a8cd8;
        }
        
        .share-facebook {
            background-color: #1877F2;
        }
        
        .share-facebook:hover {
            background-color: #0d65d9;
        }
        
        .share-linkedin {
            background-color: #0A66C2;
        }
        
        .share-linkedin:hover {
            background-color: #004182;
        }
        
        @media (max-width: 480px) {
            .social-share-container {
                flex-direction: column;
                gap: 8px;
            }
            
            .share-button {
                width: 100%;
                justify-content: center;
            }
        }
        
        .citation {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .citation h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .citation a {
            color: #90cdf4;
            text-decoration: none;
            font-weight: 600;
        }
        
        .citation a:hover {
            text-decoration: underline;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .reform-comparison {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 25px 20px;
            }
            
            header h1 {
                font-size: 1.8em;
            }
            
            header .subtitle {
                font-size: 1em;
            }
            
            .content {
                padding: 20px;
                gap: 20px;
            }
            
            .section {
                padding: 20px;
            }
            
            .section h2 {
                font-size: 1.3em;
            }
            
            .preset-buttons {
                grid-template-columns: 1fr;
            }
            
            .result-main {
                font-size: 3em;
            }
            
            .lever-label {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.5em;
            }
            
            .result-main {
                font-size: 2.5em;
            }
            
            .validation-badge {
                font-size: 0.8em;
                padding: 6px 12px;
            }
            
            .preset-button {
                padding: 14px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CBDT Framework Calculator</h1>
            <div class="subtitle">Consumer-Driven Black Market Displacement Framework</div>
            <div class="validation-badge">‚úì Validated: 5% MAE Across 24 U.S. Markets</div>
            
            <!-- Social Sharing Buttons -->
            <div class="social-share-container">
                <a href="https://twitter.com/intent/tweet?url=https://www.cbdttheory.com/&text=Check%20out%20this%20validated%20CBDT%20Framework%20calculator%20for%20predicting%20cannabis%20market%20outcomes%20with%20federal%20reform%20impact%20analysis&via=The_Silent_420" 
                   class="share-button share-twitter" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   aria-label="Share on Twitter">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                    Twitter
                </a>
                
                <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.cbdttheory.com/" 
                   class="share-button share-facebook" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   aria-label="Share on Facebook">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    Facebook
                </a>
                
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.cbdttheory.com/" 
                   class="share-button share-linkedin" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   aria-label="Share on LinkedIn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                    LinkedIn
                </a>
            </div>
        </header>
        
        <div class="content">
            <!-- Left Column: Policy Levers -->
            <div>
                <div class="section">
                    <div class="preset-buttons">
                        <button class="preset-button" onclick="loadMichiganPreset()">Michigan (85%)</button>
                        <button class="preset-button" onclick="loadColoradoPreset()">Colorado (84%)</button>
                        <button class="preset-button" onclick="loadOregonPreset()">Oregon (82%)</button>
                        <button class="preset-button" onclick="loadCaliforniaPreset()">California (50%)</button>
                        <button class="preset-button" onclick="loadNewYorkPreset()">New York (30%)</button>
                        <button class="preset-button" onclick="resetToDefaults()">Typical Market</button>
                    </div>
                    
                    <h2>State Policy Levers</h2>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Price Gap (g)</span>
                            <span class="lever-value" id="priceDisplay">$0.00</span>
                        </div>
                        <div class="lever-description">
                            Legal vs. illicit price gap per gram. Negative = legal cheaper.
                        </div>
                        <input type="range" id="priceGap" min="-0.5" max="0.5" step="0.01" value="0" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Access Density (D)</span>
                            <span class="lever-value" id="densityDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Dispensary density (stores per 100k residents, normalized)
                        </div>
                        <input type="range" id="density" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Safety/Quality (S)</span>
                            <span class="lever-value" id="safetyDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Testing requirements and product quality standards
                        </div>
                        <input type="range" id="safety" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Convenience (F)</span>
                            <span class="lever-value" id="convenienceDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Operating hours, delivery, payment options
                        </div>
                        <input type="range" id="convenience" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Enforcement (E)</span>
                            <span class="lever-value" id="enforcementDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Illicit market enforcement intensity
                        </div>
                        <input type="range" id="enforcement" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                    
                    <div class="lever-group">
                        <div class="lever-label">
                            <span>Fragmentation (F_frag)</span>
                            <span class="lever-value" id="fragDisplay">0.50</span>
                        </div>
                        <div class="lever-description">
                            Local bans and market fragmentation
                        </div>
                        <input type="range" id="fragmentation" min="0" max="1" step="0.01" value="0.5" oninput="calculate()">
                    </div>
                </div>
                
                <div class="section" style="margin-top: 20px;">
                    <h2>Federal Reform Impact</h2>
                    
                    <label class="checkbox-label" for="remove280E">
                        <input type="checkbox" id="remove280E" onchange="calculate()">
                        <div class="checkbox-text">
                            <div class="checkbox-title">‚úì Eliminate IRS 280E Tax Code</div>
                            <div class="checkbox-desc">
                                Allows ordinary business expense deductions, reducing effective tax rates from 60-75% to 21%. Enables 30-40% consumer price reductions while maintaining operator margins.
                            </div>
                        </div>
                    </label>
                    
                    <label class="checkbox-label" for="safeBanking">
                        <input type="checkbox" id="safeBanking" onchange="calculate()">
                        <div class="checkbox-text">
                            <div class="checkbox-title">‚úì Pass SAFE Banking Act</div>
                            <div class="checkbox-desc">
                                Provides banking access, reducing operational costs by 15-25% (eliminates cash-only security, enables digital payments). Improves consumer convenience significantly.
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Right Column: Results -->
            <div>
                <div class="results">
                    <div class="result-label">Predicted Legal Market Share</div>
                    <div class="result-main" id="marketShare">50%</div>
                    <div class="utility-score">
                        Utility Score (ŒîU): <strong id="utilityScore">0.00</strong>
                    </div>
                    <div class="result-interpretation" id="interpretation">
                        Adjust the policy levers to see how different regulatory approaches affect legal market capture.
                    </div>
                    
                    <div class="reform-impact-box" id="reformImpactBox">
                        <div class="reform-impact-title">üéØ Federal Reform Impact</div>
                        <div class="reform-impact-details" id="reformImpactText"></div>
                        <div class="reform-comparison">
                            <div class="reform-stat">
                                <div class="reform-stat-label">Before Reforms</div>
                                <div class="reform-stat-value" id="beforeReform">--</div>
                            </div>
                            <div class="reform-stat">
                                <div class="reform-stat-label">After Reforms</div>
                                <div class="reform-stat-value" id="afterReform">--</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>About This Calculator</h2>
                    <div class="info-section">
                        <h3>The CBDT Framework</h3>
                        <p>
                            The Consumer-Driven Black Market Displacement (CBDT) Framework is a validated economic model 
                            predicting legal cannabis market share based on six state policy levers and federal reforms.
                        </p>
                        <p><strong>Validation Results:</strong></p>
                        <ul>
                            <li>24 U.S. states analyzed</li>
                            <li>5% Mean Absolute Error (MAE)</li>
                            <li>r = 0.968 correlation</li>
                            <li>Published via Harvard Dataverse</li>
                        </ul>
                        <p style="margin-top: 15px;">
                            <strong>Core Formula:</strong><br>
                            ŒîU = 4(‚àíg) + D + 1.2S + F + 0.6E ‚àí 0.8F_frag<br>
                            Market Share = 1 / (1 + e^(‚àíŒîU))
                        </p>
                        <p style="margin-top: 15px;">
                            <strong>Federal Reform Adjustments:</strong><br>
                            ‚Ä¢ 280E elimination: -$0.15/g price reduction<br>
                            ‚Ä¢ SAFE Banking: +0.15 convenience boost
                        </p>
                        <p style="margin-top: 20px;">
                            <a href="https://www.silentmajority420.com/cbdt-framework-calculator/" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.2s ease;">
                                üìñ How to Use This Calculator
                            </a>
                        </p>
                    </div>
                </div>
                
                <div class="section">
                    <h2>State-by-State Analysis</h2>
                    <div class="info-section">
                        <p style="margin-bottom: 15px;">
                            Explore detailed cannabis market analysis for any U.S. state using the CBDT Framework:
                        </p>
                        <select id="stateSelector" style="width: 100%; padding: 12px; font-size: 1em; border-radius: 8px; border: 2px solid #667eea; margin-bottom: 10px;">
                            <option value="">Select a state...</option>
                            <option value="alabama">Alabama</option>
                            <option value="alaska">Alaska</option>
                            <option value="arizona">Arizona</option>
                            <option value="arkansas">Arkansas</option>
                            <option value="california">California</option>
                            <option value="colorado">Colorado</option>
                            <option value="connecticut">Connecticut</option>
                            <option value="delaware">Delaware</option>
                            <option value="florida">Florida</option>
                            <option value="georgia">Georgia</option>
                            <option value="hawaii">Hawaii</option>
                            <option value="idaho">Idaho</option>
                            <option value="illinois">Illinois</option>
                            <option value="indiana">Indiana</option>
                            <option value="iowa">Iowa</option>
                            <option value="kansas">Kansas</option>
                            <option value="kentucky">Kentucky</option>
                            <option value="louisiana">Louisiana</option>
                            <option value="maine">Maine</option>
                            <option value="maryland">Maryland</option>
                            <option value="massachusetts">Massachusetts</option>
                            <option value="michigan">Michigan</option>
                            <option value="minnesota">Minnesota</option>
                            <option value="mississippi">Mississippi</option>
                            <option value="missouri">Missouri</option>
                            <option value="montana">Montana</option>
                            <option value="nebraska">Nebraska</option>
                            <option value="nevada">Nevada</option>
                            <option value="new-hampshire">New Hampshire</option>
                            <option value="new-jersey">New Jersey</option>
                            <option value="new-mexico">New Mexico</option>
                            <option value="new-york">New York</option>
                            <option value="north-carolina">North Carolina</option>
                            <option value="north-dakota">North Dakota</option>
                            <option value="ohio">Ohio</option>
                            <option value="oklahoma">Oklahoma</option>
                            <option value="oregon">Oregon</option>
                            <option value="pennsylvania">Pennsylvania</option>
                            <option value="rhode-island">Rhode Island</option>
                            <option value="south-carolina">South Carolina</option>
                            <option value="south-dakota">South Dakota</option>
                            <option value="tennessee">Tennessee</option>
                            <option value="texas">Texas</option>
                            <option value="utah">Utah</option>
                            <option value="vermont">Vermont</option>
                            <option value="virginia">Virginia</option>
                            <option value="washington">Washington</option>
                            <option value="west-virginia">West Virginia</option>
                            <option value="wisconsin">Wisconsin</option>
                            <option value="wyoming">Wyoming</option>
                        </select>
                        <button onclick="goToStateAnalysis()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer;">
                            View State Analysis
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="citation">
            <h3>Academic Citation</h3>
            <p>
                Consumer-Driven Black Market Displacement Framework (CBDT)<br>
                The Silent Majority 420 | ORCID: <a href="https://orcid.org/0009-0003-6779-9910" target="_blank">0009-0003-6779-9910</a><br>
                <a href="https://doi.org/10.7910/DVN/MDVDTQ" target="_blank">DOI: 10.7910/DVN/MDVDTQ</a> (Harvard Dataverse)
            </p>
            <p style="margin-top: 20px;">
                <a href="https://www.silentmajority420.com" target="_blank">Silent Majority 420</a> | 
                <a href="https://www.cbdttheory.com" target="_blank">CBDT Framework</a>
            </p>
        </div>
    </div>
    
    <script>
        // Real CBDT Framework Formula from Harvard Dataverse
        // ŒîU = 4(‚àíg) + D + 1.2S + F + 0.6E ‚àí 0.8F_frag
        // Market Share = 1 / (1 + e^(‚àíŒîU))
        
        // Federal reform impacts (validated estimates)
        const REFORM_280E_PRICE_REDUCTION = -0.15; // $0.15/g price reduction when 280E eliminated
        const REFORM_SAFE_BANKING_CONVENIENCE = 0.15; // +0.15 convenience boost from banking access
        
        function calculate() {
            // Get base lever values
            let g = parseFloat(document.getElementById('priceGap').value);
            const D = parseFloat(document.getElementById('density').value);
            const S = parseFloat(document.getElementById('safety').value);
            let F = parseFloat(document.getElementById('convenience').value);
            const E = parseFloat(document.getElementById('enforcement').value);
            const F_frag = parseFloat(document.getElementById('fragmentation').value);
            
            // Check federal reforms
            const has280ERemoval = document.getElementById('remove280E').checked;
            const hasSafeBanking = document.getElementById('safeBanking').checked;
            
            // Calculate baseline (before reforms)
            const baselineDeltaU = 4 * (-g) + D + 1.2 * S + F + 0.6 * E - 0.8 * F_frag;
            const baselineMarketShare = 1 / (1 + Math.exp(-baselineDeltaU));
            
            // Apply federal reform impacts
            if (has280ERemoval) {
                g += REFORM_280E_PRICE_REDUCTION; // Makes legal cannabis cheaper
            }
            if (hasSafeBanking) {
                F = Math.min(1, F + REFORM_SAFE_BANKING_CONVENIENCE); // Boosts convenience
            }
            
            // Update displays
            document.getElementById('priceDisplay').textContent = '$' + g.toFixed(2);
            document.getElementById('densityDisplay').textContent = D.toFixed(2);
            document.getElementById('safetyDisplay').textContent = S.toFixed(2);
            document.getElementById('convenienceDisplay').textContent = F.toFixed(2);
            document.getElementById('enforcementDisplay').textContent = E.toFixed(2);
            document.getElementById('fragDisplay').textContent = F_frag.toFixed(2);
            
            // Calculate utility score (ŒîU) with reforms
            const deltaU = 4 * (-g) + D + 1.2 * S + F + 0.6 * E - 0.8 * F_frag;
            
            // Calculate market share using logistic function
            const marketShare = 1 / (1 + Math.exp(-deltaU));
            const marketSharePercent = (marketShare * 100).toFixed(0);
            
            // Update results
            document.getElementById('marketShare').textContent = marketSharePercent + '%';
            document.getElementById('utilityScore').textContent = deltaU.toFixed(2);
            
            // Show/hide federal reform impact box
            const reformBox = document.getElementById('reformImpactBox');
            if (has280ERemoval || hasSafeBanking) {
                reformBox.classList.add('active');
                
                // Calculate improvement
                const improvement = ((marketShare - baselineMarketShare) * 100).toFixed(1);
                const baselinePercent = (baselineMarketShare * 100).toFixed(0);
                
                // Update reform impact text
                let reformText = 'Federal reforms improve market competitiveness:<br><br>';
                if (has280ERemoval) {
                    reformText += '‚Ä¢ <strong>280E Elimination:</strong> Operators can deduct ordinary expenses, enabling 30-40% consumer price reductions. This improves legal price competitiveness significantly.<br>';
                }
                if (hasSafeBanking) {
                    reformText += '‚Ä¢ <strong>SAFE Banking:</strong> Banking access reduces cash-only costs and enables digital payments, improving convenience by 15-25%.<br>';
                }
                reformText += `<br>Combined impact: <strong>+${improvement} percentage points</strong> in legal market share.`;
                
                document.getElementById('reformImpactText').innerHTML = reformText;
                document.getElementById('beforeReform').textContent = baselinePercent + '%';
                document.getElementById('afterReform').textContent = marketSharePercent + '%';
            } else {
                reformBox.classList.remove('active');
            }
            
            // Update interpretation
            let interpretation = '';
            if (marketShare >= 0.85) {
                interpretation = 'üéØ Excellent policy design! This configuration achieves 85%+ legal market capture, effectively displacing the illicit market.';
            } else if (marketShare >= 0.70) {
                interpretation = '‚úÖ Strong performance. This policy framework captures 70-84% of the market, with room for optimization.';
            } else if (marketShare >= 0.50) {
                interpretation = '‚ö†Ô∏è Moderate success. Legal market captures 50-69% share. Consider improving price competitiveness, access density, or convenience factors.';
            } else if (marketShare >= 0.30) {
                interpretation = '‚ùå Weak performance. Legal market captures only 30-49% share. Significant policy improvements needed across multiple levers.';
            } else {
                interpretation = 'üö´ Poor policy design. Legal market captures less than 30% share. Major reforms required to price gap, access, or quality standards.';
            }
            
            // Add federal reform suggestion if not enabled
            if (!has280ERemoval && !hasSafeBanking && marketShare < 0.85) {
                interpretation += ' Federal reforms (280E elimination, SAFE Banking) could significantly improve outcomes.';
            }
            
            document.getElementById('interpretation').textContent = interpretation;
        }
        
        // Preset button functions using real validated state data
        function loadMichiganPreset() {
            document.getElementById('priceGap').value = -0.08;
            document.getElementById('density').value = 0.75;
            document.getElementById('safety').value = 0.80;
            document.getElementById('convenience').value = 0.75;
            document.getElementById('enforcement').value = 0.70;
            document.getElementById('fragmentation').value = 0.15;
            document.getElementById('remove280E').checked = false;
            document.getElementById('safeBanking').checked = false;
            calculate();
        }
        
        function loadColoradoPreset() {
            document.getElementById('priceGap').value = -0.15;
            document.getElementById('density').value = 0.80;
            document.getElementById('safety').value = 0.85;
            document.getElementById('convenience').value = 0.80;
            document.getElementById('enforcement').value = 0.75;
            document.getElementById('fragmentation').value = 0.10;
            document.getElementById('remove280E').checked = false;
            document.getElementById('safeBanking').checked = false;
            calculate();
        }
        
        function loadOregonPreset() {
            document.getElementById('priceGap').value = -0.20;
            document.getElementById('density').value = 0.85;
            document.getElementById('safety').value = 0.80;
            document.getElementById('convenience').value = 0.75;
            document.getElementById('enforcement').value = 0.70;
            document.getElementById('fragmentation').value = 0.05;
            document.getElementById('remove280E').checked = false;
            document.getElementById('safeBanking').checked = false;
            calculate();
        }
        
        function loadCaliforniaPreset() {
            document.getElementById('priceGap').value = 0.15;
            document.getElementById('density').value = 0.60;
            document.getElementById('safety').value = 0.70;
            document.getElementById('convenience').value = 0.50;
            document.getElementById('enforcement').value = 0.40;
            document.getElementById('fragmentation').value = 0.40;
            document.getElementById('remove280E').checked = false;
            document.getElementById('safeBanking').checked = false;
            calculate();
        }
        
        function loadNewYorkPreset() {
            document.getElementById('priceGap').value = 0.25;
            document.getElementById('density').value = 0.30;
            document.getElementById('safety').value = 0.60;
            document.getElementById('convenience').value = 0.40;
            document.getElementById('enforcement').value = 0.50;
            document.getElementById('fragmentation').value = 0.35;
            document.getElementById('remove280E').checked = false;
            document.getElementById('safeBanking').checked = false;
            calculate();
        }
        
        function resetToDefaults() {
            document.getElementById('priceGap').value = 0;
            document.getElementById('density').value = 0.5;
            document.getElementById('safety').value = 0.5;
            document.getElementById('convenience').value = 0.5;
            document.getElementById('enforcement').value = 0.5;
            document.getElementById('fragmentation').value = 0.5;
            document.getElementById('remove280E').checked = false;
            document.getElementById('safeBanking').checked = false;
            calculate();
        }
        
        // Initial calculation
        calculate();
        
        // State analysis navigation function
        function goToStateAnalysis() {
            const selector = document.getElementById('stateSelector');
            const state = selector.value;
            
            if (!state) {
                alert('Please select a state first');
                return;
            }
            
            const url = `https://silentmajority420.com/${state}-cannabis-market-analysis/`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>
